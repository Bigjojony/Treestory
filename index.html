<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TREESTORY // MOBILE READY</title>
    <script src="data.js" defer></script>
    <style>
        :root {
            --bg: #080808; --surface: #121212; --border: #1f1f1f;
            --text: #efefef; --dim: #777; --accent: #fff; --radius: 18px;
        }

        body { 
            background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; 
            margin: 0; display: flex; height: 100vh; overflow: hidden;
            flex-direction: row;
        }

        /* --- NAVIGATION SIDEBAR (Desktop) / HEADER (Mobile) --- */
        aside { 
            width: 260px; border-right: 1px solid var(--border); padding: 40px 20px; 
            display: flex; flex-direction: column; gap: 30px; transition: 0.3s;
            background: var(--bg); z-index: 500;
        }

        .logo { font-weight: 900; font-size: 20px; letter-spacing: -0.5px; border-bottom: 2px solid var(--accent); width: fit-content; padding-bottom: 5px; }
        .nav-label { font-size: 10px; text-transform: uppercase; color: var(--dim); letter-spacing: 1.5px; margin-bottom: 12px; display: block; }
        #category-filters { display: flex; flex-direction: column; gap: 8px; }
        
        .filter-btn { 
            background: none; border: 1px solid var(--border); color: var(--text); padding: 10px 14px; 
            border-radius: 10px; cursor: pointer; text-align: left; transition: 0.2s; font-size: 13px;
        }
        .filter-btn.active { background: var(--accent); color: #000; }

        /* --- MOBILE TOGGLE --- */
        #menu-toggle { display: none; position: fixed; bottom: 20px; right: 20px; z-index: 1000; background: var(--accent); color: #000; border: none; padding: 15px; border-radius: 50%; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }

        /* --- MAIN AREA --- */
        main { flex: 1; overflow-y: auto; padding: 60px; -webkit-overflow-scrolling: touch; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }

        /* --- CARDS --- */
        .card { 
            background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); 
            padding: 25px; cursor: pointer; transition: 0.3s ease; position: relative;
        }
        .badge { font-size: 8px; background: #222; padding: 3px 8px; border-radius: 4px; position: absolute; top: 20px; right: 20px; text-transform: uppercase; }

        /* --- MODAL (Responsive) --- */
        #modal { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); 
            display: none; align-items: center; justify-content: center; z-index: 2000; 
        }
        .modal-box { background: #161616; border: 1px solid var(--border); width: 90%; max-width: 650px; height: auto; max-height: 90vh; border-radius: 24px; overflow-y: auto; position: relative; }
        .close-btn { position: absolute; top: 15px; right: 15px; background: #222; border: none; color: #fff; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; z-index: 10; }

        .modal-header { padding: 30px; }
        .tabs { display: flex; border-bottom: 1px solid var(--border); padding: 0 20px; gap: 10px; overflow-x: auto; }
        .tab-btn { background: none; border: none; color: var(--dim); padding: 15px 10px; cursor: pointer; font-weight: 600; font-size: 12px; white-space: nowrap; }
        .tab-btn.active { color: var(--accent); border-bottom: 2px solid var(--accent); }
        .tab-content { padding: 30px; display: none; }
        .tab-content.active { display: block; }

        /* --- MEDIA QUERIES (MOBILE) --- */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            aside { 
                position: fixed; left: -260px; top: 0; bottom: 0; width: 220px; 
                box-shadow: 10px 0 30px rgba(0,0,0,0.5);
            }
            aside.open { left: 0; }
            #menu-toggle { display: block; }
            main { padding: 30px 20px; }
            .grid { grid-template-columns: 1fr; }
            .modal-box { width: 100%; height: 100%; border-radius: 0; max-height: 100vh; }
        }

        .linked-card { background: #222; padding: 15px; border-radius: 12px; margin-bottom: 12px; }
    </style>
</head>
<body>

<button id="menu-toggle" onclick="toggleMenu()">‚ò∞</button>

<aside id="sidebar">
    <div class="logo">TREESTORY.</div>
    <div>
        <span class="nav-label">Filtrer</span>
        <div id="category-filters">
            <button class="filter-btn active" onclick="filterData('all', this)">Toutes les archives</button>
        </div>
    </div>
</aside>

<main onclick="closeMenu()">
    <div class="grid" id="appGrid"></div>
</main>

<div id="modal" onclick="closeModal()">
    <div class="modal-box" onclick="event.stopPropagation()">
        <button class="close-btn" onclick="closeModal()">√ó</button>
        <div class="modal-header">
            <span id="m-date" style="font-size: 11px; color: var(--dim)"></span>
            <h1 id="m-title" style="margin:5px 0; font-size: 22px;"></h1>
            <div id="m-meta" style="font-size: 12px; opacity: 0.6"></div>
        </div>
        <div class="tabs">
            <button class="tab-btn active" onclick="tab(event, 'details')">R√âSUM√â</button>
            <button class="tab-btn" onclick="tab(event, 'links')">LIAISONS</button>
            <button class="tab-btn" onclick="tab(event, 'sources')">SOURCE</button>
        </div>
        <div id="details" class="tab-content active"></div>
        <div id="links" class="tab-content"></div>
        <div id="sources" class="tab-content"></div>
    </div>
</div>

<script>
    window.onload = () => { initCategories(); render(database); };

    function initCategories() {
        const filterContainer = document.getElementById('category-filters');
        const categories = [...new Set(database.map(item => item.cat))];
        categories.forEach(cat => {
            const btn = document.createElement('button');
            btn.className = 'filter-btn';
            btn.innerText = cat;
            btn.onclick = (e) => { filterData(cat, e.target); closeMenu(); };
            filterContainer.appendChild(btn);
        });
    }

    function render(items) {
        document.getElementById('appGrid').innerHTML = items.map(n => `
            <div class="card" onclick="openNode('${n.id}')">
                <span class="badge">${n.cat}</span>
                <div class="card-date">${n.date}</div>
                <div class="card-title">${n.title}</div>
            </div>
        `).join('');
    }

    function openNode(id) {
        const n = database.find(x => x.id === id);
        document.getElementById('m-title').innerText = n.title;
        document.getElementById('m-date').innerText = n.date;
        document.getElementById('m-meta').innerText = `üìç ${n.country}`;
        document.getElementById('details').innerHTML = `<p style="line-height:1.6">${n.info}</p>`;
        
        const linksHtml = n.links.map(lId => {
            const rel = database.find(x => x.id === lId);
            return rel ? `<div class="linked-card" onclick="openNode('${rel.id}')"><b>${rel.title}</b><br><small>${rel.short}</small></div>` : '';
        }).join('');
        document.getElementById('links').innerHTML = linksHtml || 'Aucune liaison.';
        document.getElementById('sources').innerHTML = `<a href="${n.wiki}" target="_blank" style="color:#fff">Wikipedia ‚Üó</a>`;
        document.getElementById('modal').style.display = 'flex';
        tab(null, 'details');
    }

    function tab(e, tabId) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        if(e) e.currentTarget.classList.add('active');
        else document.querySelector('.tab-btn').classList.add('active');
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    function toggleMenu() { document.getElementById('sidebar').classList.toggle('open'); }
    function closeMenu() { document.getElementById('sidebar').classList.remove('open'); }
    function filterData(cat, btn) {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        render(cat === 'all' ? database : database.filter(n => n.cat === cat));
    }
</script>
</body>
</html>